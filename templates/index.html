<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Finance Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>

<body>
    <div class="top_bar">
        <h1>Expenses Calculator</h1>
    </div>

    <div class="apple"></div>

    <div class="wrapper">
        <div class="content">
            <label for="content"></label> 

            <table>
                {% if tasks|length == 0 %}
                <tr>
                    <td colspan="7" style="text-align: center; vertical-align: middle; padding: 250px 0;">
                        Nothing here yet
                    </td>
                </tr>
                {% else %}
                <tr id="tit">
                    <th>Id</th>
                    <th>Name</th>
                    <th>Date</th>
                    <th>Price</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Actions</th>
                </tr>

                {% for task in tasks %}
                <tr>
                    <td align="center">{{ task.Item_Id }}</td>
                    <td align="center">{{ task.Item_Name }}</td>
                    <td align="center">{{ task.Item_Date }}</td>
                    <td align="center">{{ task.Item_Price }}</td>
                    <td align="center">{{ task.Item_Description }}</td>
                    {% if task.Item_Category == 'groseries' %}
                        <td align="center" style="background-color: bisque;">{{ task.Item_Category }}</td>
                    {% elif task.Item_Category == 'restaurants' %}
                        <td align="center" style="background-color: lightcoral;">{{ task.Item_Category }}</td>
                    {% elif task.Item_Category == 'pharmacy' %}
                        <td align="center" style="background-color: lightseagreen;">{{ task.Item_Category }}</td>
                    {% elif task.Item_Category == 'public_transport' %}
                        <td align="center" style="background-color: lightgrey;">{{ task.Item_Category }}</td>
                    {% else %}
                        <td align="center">{{ task.Item_Category }}</td>
                    {% endif %}

                    <td align="right">
                        <a href="/delete/{{ task.Item_Id }}">Delete</a><br>
                        <a href="/update/{{ task.Item_Id }}">Edit</a>
                    </td>
                </tr>
                {% endfor %}
                {% endif %}
            </table>
        </div>

        <div class="form"> 
            <form action="/" method="POST">
                <h4>Enter name</h4>
                <input type="text" name="content" id="content">
                
                <h4>Enter date</h4>
                <input type="date" name="date" id="date">
                
                <h4>Enter price</h4>
                <input type="text" name="price" id="price">
                
                <h4>Enter description (optional)</h4>
                <input type="text" name="description" id="description">
                
                <h4>Choose category</h4>
                <select id="category" name="category">
                    <option value="category">Select Category</option>
                    <option value="groseries">Groceries</option>
                    <option value="restaurants">Restaurants & Caf√©s</option>
                    <option value="pharmacy">Pharmacy & Health Products</option>
                    <option value="public_transport">Public Transport</option>
                    <option value="others">Others</option>
                </select>
                
                <br><br>
                <input type="submit" value="Add Purchase">
            </form>
        </div>
    </div>

    <div class="final">
        <div class="chart">
            <canvas id="expensesChart" width="400" height="400"></canvas>
        </div>
        <div class="results">
            <h3>Groceries Percentage: {{ grocery_percent }}%</h3>
            <h3>Restaurants Percentage: {{ restourants_percent }}%</h3>
            <h3>Pharmacy Percentage: {{ pharmacy_percent }}%</h3>
            <h3>Public Transport Percentage: {{ public_transport_percent }}%</h3>
            <h3>Others: {{ other_percent }}%</h3>
        </div>
    </div>

    <script>
        fetch('/chart-data')
            .then(response => response.json())
            .then(data => {
                const ctx = document.getElementById('expensesChart').getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: data.labels,
                        datasets: [{
                            label: 'Expenses by Category',
                            data: data.amounts,
                            backgroundColor: [
                                'rgba(255, 206, 86, 0.6)',    
                                'rgba(255, 99, 132, 0.6)',    
                                'rgba(54, 162, 235, 0.6)',   
                                'rgba(75, 192, 192, 0.6)',   
                                'rgba(201, 203, 207, 0.6)'    
                            ],
                            borderColor: [
                                'rgba(255, 206, 86, 1)',
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(201, 203, 207, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'right',
                            },
                            tooltip: {
                                enabled: true
                            }
                        }
                    }
                });
            });
    </script>
    
</body>
</html>
